unit uGpsResource;

// EMS Resource Module

interface

uses
  System.SysUtils, System.Classes, System.JSON,
  EMS.Services, EMS.ResourceAPI, EMS.ResourceTypes, System.Sensors,
  System.Sensors.Components;

type
  [ResourceName('gps')]
  TGpsResource1 = class(TDataModule)
    LocationSensor1: TLocationSensor;
    procedure LocationSensor1LocationChanged(Sender: TObject; const OldLocation,
      NewLocation: TLocationCoord2D);
  published
    procedure Get(const AContext: TEndpointContext; const ARequest: TEndpointRequest; const AResponse: TEndpointResponse);
  private
    fLatitude: string;
    fLongitude: string;
  end;

implementation

{%CLASSGROUP 'System.Classes.TPersistent'}

{$R *.dfm}

procedure TGpsResource1.Get(const AContext: TEndpointContext; const ARequest: TEndpointRequest; const AResponse: TEndpointResponse);
begin
  // Sample code
  AResponse.Body.SetValue(TJSONString.Create('gps'), True);
end;

procedure Register;
begin
  RegisterResource(TypeInfo(TGpsResource1));
end;

procedure TGpsResource1.LocationSensor1LocationChanged(Sender: TObject;
  const OldLocation, NewLocation: TLocationCoord2D);
begin
  fLatitude := NewLocation.Latitude.ToString;
  fLongitude := NewLocation.Longitude.ToString;
end;

initialization
  Register;
end.


